<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/main-layout}">
<head>
  <title>Alle Buchungen</title>
</head>
<body>

<div layout:fragment="content" th:with="activeMenuItem='bookings'">

  <div class="page-header" style="margin-bottom: 2rem;">
    <h1 style="color: var(--dark-green); font-size: 1.8rem; font-weight: 700;">Bookings Overview</h1>
    <p class="subtitle">Verwaltung aller Buchungen und Transaktionen</p>
  </div>

  <div th:if="${successMessage}" style="background-color: #d4edda; color: #155724; padding: 1rem; border-radius: 4px; margin-bottom: 1.5rem; border: 1px solid #c3e6cb;">
    <span th:text="${successMessage}">Erfolg!</span>
  </div>

  <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2rem;">

    <div class="card stat-card-border-green">
      <span class="stat-label">TOTAL BOOKINGS</span>
      <span class="stat-value" th:text="${totalBookingsCount}">0</span>
      <span class="stat-desc">Total bookings in system</span>
    </div>

    <div class="card stat-card-border-blue">
      <span class="stat-label">PENDING CHECK-INS</span>
      <span class="stat-value" th:text="${pendingCheckIns}">0</span>
      <span class="stat-desc">Guests expected to arrive</span>
    </div>

    <div class="card stat-card-border-orange">
      <span class="stat-label">TOTAL REVENUE (EST.)</span>
      <span class="stat-value" th:text="'€ ' + ${#numbers.formatDecimal(totalRevenue, 1, 0)}">€ 0</span>
      <span class="stat-desc">Estimated revenue based on bookings</span>
    </div>
  </div>

  <div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
      <h3 style="margin: 0; color: var(--dark-green);">Buchungsliste</h3>
      <a th:href="@{/bookings/walk-in}" class="btn-primary" style="background-color: var(--primary-orange); border: none;">+ Neue Buchung</a>
    </div>

    <div class="table-scroll">
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
        <tr style="background-color: #f9f9f9; text-align: left; border-bottom: 2px solid #eee;">
          <th style="padding: 12px; color: var(--dark-green); font-weight: 600;">ID</th>
          <th style="padding: 12px; color: var(--dark-green); font-weight: 600;">Gast Name</th>
          <th style="padding: 12px; color: var(--dark-green); font-weight: 600;">Event</th>
          <th style="padding: 12px; color: var(--dark-green); font-weight: 600;">Zeit</th>
          <th style="padding: 12px; color: var(--dark-green); font-weight: 600;">Status</th>
          <th style="padding: 12px; color: var(--dark-green); font-weight: 600;">Zahlung</th>
          <th style="padding: 12px; color: var(--dark-green); font-weight: 600;">Aktionen</th> </tr>
        </thead>
        <tbody>
        <tr th:each="booking : ${bookings}" style="border-bottom: 1px solid #eee;">
          <td style="padding: 12px; font-weight: bold; color: #666;" th:text="${booking.bookingNumber}">B-100</td>
          <td style="padding: 12px;">
            <strong th:text="${booking.guestName}">Name</strong>
            <br><span style="font-size: 0.8rem; color: #888;" th:text="${booking.type}">TYP</span>
          </td>
          <td style="padding: 12px;">
            <span th:text="${booking.eventName}">Event</span>
            <br><small th:text="${booking.participantCount} + ' Pers.'">1 Pers.</small>
          </td>

          <td style="padding: 12px;" th:text="${#temporals.format(booking.eventDateTime, 'dd.MM.yyyy HH:mm')}">01.01.2025 10:00</td>

          <td style="padding: 12px;">
            <span th:if="${booking.cancelled}"
                  style="background-color: #ffcdd2; color: #c62828; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;">Cancelled</span>

            <span th:if="${booking.checkedOut}"
                  style="background-color: #eee; color: #333; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;">Completed</span>

            <span th:if="${!booking.checkedOut and booking.checkedIn}"
                  style="background-color: #e3f2fd; color: #0277bd; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;">Checked In</span>

            <span th:if="${!booking.checkedIn and !booking.cancelled}"
                  style="background-color: #fff3e0; color: #ef6c00; padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;">Pending</span>
          </td>

          <td style="padding: 12px;">
            <span th:if="${booking.paid}" style="color: var(--light-green); font-weight: bold;">Bezahlt</span>
            <span th:if="${!booking.paid}" style="color: #c62828;">Offen</span>
          </td>

          <td style="padding: 12px;">
            <form th:if="${!booking.cancelled and !booking.checkedOut}"
                  th:action="@{/bookings/cancel}" method="post"
                  onsubmit="return confirm('Buchung wirklich stornieren? Gebühren können anfallen.');">
              <input type="hidden" name="id" th:value="${booking.id}"/>
              <button type="submit" style="background: none; border: 1px solid #c62828; color: #c62828; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">
                Stornieren (WI #57)
              </button>
            </form>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

</body>
</html>